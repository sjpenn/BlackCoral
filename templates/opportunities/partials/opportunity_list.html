{% for opportunity in opportunities %}
<div class="opportunity-card">
    <div class="opportunity-header">
        <div class="flex justify-between items-start gap-4">
            <div class="flex-1">
                <h3 class="mb-2">
                    <a href="{% url 'opportunities:detail' opportunity.id %}" 
                       class="text-primary hover:opacity-80 no-underline">
                        {{ opportunity.title }}
                    </a>
                </h3>
                <div class="opportunity-meta">
                    <strong>{{ opportunity.solicitation_number }}</strong>
                    {% if opportunity.agency %}
                        ‚Ä¢ {{ opportunity.agency.name }}
                    {% endif %}
                    {% if opportunity.opportunity_type %}
                        ‚Ä¢ {{ opportunity.opportunity_type }}
                    {% endif %}
                    {% if opportunity.set_aside_type %}
                        ‚Ä¢ {{ opportunity.set_aside_type }}
                    {% endif %}
                </div>
                <div class="opportunity-meta">
                    Posted: {{ opportunity.posted_date|date:"M d, Y" }}
                    {% if opportunity.response_date %}
                        ‚Ä¢ Response Due: {{ opportunity.response_date|date:"M d, Y" }}
                        {% if opportunity.days_until_response %}
                            ({{ opportunity.days_until_response }} days left)
                        {% endif %}
                    {% endif %}
                </div>
                {% if opportunity.naics_codes.exists %}
                <div class="opportunity-meta">
                    NAICS: 
                    {% for naics in opportunity.naics_codes.all %}
                        <span class="bg-muted text-muted-foreground px-2 py-1 rounded text-xs mr-1">
                            {{ naics.code }}
                        </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            <div>
                {% if opportunity.is_open %}
                    {% if opportunity.days_until_response and opportunity.days_until_response <= 7 %}
                        <span class="status-badge status-closing">Closing Soon</span>
                    {% else %}
                        <span class="status-badge status-open">Open</span>
                    {% endif %}
                {% else %}
                    <span class="status-badge status-closed">Closed</span>
                {% endif %}
            </div>
        </div>
        
        {% if opportunity.description %}
        <div class="mt-4 text-muted-foreground text-sm">
            {{ opportunity.description|truncatewords:30 }}
        </div>
        {% endif %}
    </div>
    
    <div class="opportunity-actions flex justify-between items-center">
        <div class="flex gap-4 items-center text-sm text-muted-foreground">
            {% if opportunity.documents.exists %}
            <span>üìÑ {{ opportunity.documents.count }} document{{ opportunity.documents.count|pluralize }}</span>
            {% endif %}
            {% if opportunity.documents_fetched %}
                <span class="text-chart-5">‚úì Docs fetched</span>
            {% endif %}
            {% if opportunity.ai_analysis_complete %}
                <span class="text-chart-5">ü§ñ AI analyzed</span>
            {% endif %}
            {% if opportunity.compliance_checked %}
                <span class="text-chart-5">‚úì Compliance checked</span>
            {% endif %}
            {% if opportunity.usaspending_analyzed %}
                <span class="text-chart-5">üìä Spending analyzed</span>
            {% endif %}
        </div>
        
        <div class="flex gap-2">
            <a href="{% url 'opportunities:detail' opportunity.id %}" 
               class="btn btn-primary px-4 py-2 text-sm">
                View Details
            </a>
            <a href="{% url 'agents:opportunity_analysis' opportunity.id %}" 
               class="btn btn-agent-army px-4 py-2 text-sm">
                ü§ñ AI Analysis
            </a>
            {% if opportunity.source_url %}
            <a href="{{ opportunity.source_url }}" 
               target="_blank"
               class="btn btn-secondary px-4 py-2 text-sm">
                SAM.gov ‚Üó
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% empty %}
<div class="text-center py-12 text-muted-foreground">
    <div class="text-6xl mb-4">üîç</div>
    <h3>No opportunities found</h3>
    <p>Try adjusting your search filters or refresh from SAM.gov to get the latest opportunities.</p>
    {% if user.can_research_opportunities %}
    <button 
        hx-post="{% url 'opportunities:refresh' %}"
        hx-target="#refresh-status"
        class="btn btn-primary mt-4">
        Refresh from SAM.gov
    </button>
    {% endif %}
</div>
{% endfor %}

<!-- Pagination -->
{% if opportunities.has_other_pages %}
<div class="pagination">
    {% if opportunities.has_previous %}
    <a href="#" 
       hx-get="{% url 'opportunities:list' %}?page={{ opportunities.previous_page_number }}{% if filters.search %}&search={{ filters.search }}{% endif %}{% if filters.naics %}&naics={{ filters.naics }}{% endif %}{% if filters.agency %}&agency={{ filters.agency }}{% endif %}{% if filters.status %}&status={{ filters.status }}{% endif %}"
       hx-target="#opportunity-results"
       class="page-link">‚Üê Previous</a>
    {% endif %}
    
    {% for num in opportunities.paginator.page_range %}
        {% if opportunities.number == num %}
            <span class="page-link active">{{ num }}</span>
        {% elif num > opportunities.number|add:'-3' and num < opportunities.number|add:'3' %}
            <a href="#"
               hx-get="{% url 'opportunities:list' %}?page={{ num }}{% if filters.search %}&search={{ filters.search }}{% endif %}{% if filters.naics %}&naics={{ filters.naics }}{% endif %}{% if filters.agency %}&agency={{ filters.agency }}{% endif %}{% if filters.status %}&status={{ filters.status }}{% endif %}"
               hx-target="#opportunity-results"
               class="page-link">{{ num }}</a>
        {% endif %}
    {% endfor %}
    
    {% if opportunities.has_next %}
    <a href="#"
       hx-get="{% url 'opportunities:list' %}?page={{ opportunities.next_page_number }}{% if filters.search %}&search={{ filters.search }}{% endif %}{% if filters.naics %}&naics={{ filters.naics }}{% endif %}{% if filters.agency %}&agency={{ filters.agency }}{% endif %}{% if filters.status %}&status={{ filters.status }}{% endif %}"
       hx-target="#opportunity-results"
       class="page-link">Next ‚Üí</a>
    {% endif %}
</div>
{% endif %}